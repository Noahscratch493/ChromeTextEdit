<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChromeTextEdit</title>
<!-- Include Quill.js library -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<!-- Include AI chatbot script -->
<script>
  (function (w, d, s, o, f, js, fjs) {
    w["botsonic_widget"] = o;
    w[o] =
      w[o] ||
      function () {
        (w[o].q = w[o].q || []).push(arguments);
      };
    (js = d.createElement(s)), (fjs = d.getElementsByTagName(s)[0]);
    js.id = o;
    js.src = f;
    js.async = 1;
    fjs.parentNode.insertBefore(js, fjs);
  })(window, document, "script", "Botsonic", "https://widget.writesonic.com/CDN/botsonic.min.js");
  Botsonic("init", {
    serviceBaseUrl: "https://api.botsonic.ai",
    token: "f47503cf-8afe-4de4-9954-4f29f91169f1",
  });
</script>
<style>
    body {
        font-family: 'Product Sans', sans-serif;
    }

    #editor-container {
        margin: 20px auto;
        max-width: 800px;
    }

    #editor {
        height: 400px;
    }

    .embed-option {
        margin-right: 10px;
    }

    .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5); /* Semi-transparent black overlay */
        display: none;
        justify-content: center;
        align-items: center;
    }

    .popup-content {
        background: #fff;
        padding: 20px;
        border-radius: 5px;
    }
</style>
</head>
<body>
    <div id="editor-container">
        <div id="editor"></div>
    </div>
    <div class="popup-overlay" id="embedPopup">
        <div class="popup-content">
            <label>
                <input type="radio" name="embedOption" value="code" class="embed-option" checked>
                Embed HTML code
            </label>
            <br>
            <label>
                <input type="radio" name="embedOption" value="link" class="embed-option">
                Embed from link
            </label>
            <br>
            <input type="text" id="embedInput">
            <button id="embedButton">Embed</button>
            <button id="cancelButton">Cancel</button>
        </div>
    </div>
    
    <script>
        // Initialize Quill editor with additional features
        var quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                    ['bold', 'italic', 'underline', 'strike'],
                    ['blockquote', 'code-block'],
                    [{'list': 'ordered'}, {'list': 'bullet'}],
                    [{'script': 'sub'}, {'script': 'super'}],
                    [{'indent': '-1'}, {'indent': '+1'}],
                    [{'direction': 'rtl'}],
                    [{'align': []}],
                    ['link', 'image', 'video', 'formula'],
                    ['clean'],
                    [{ 'more': 'More' }]
                ]
            }
        });

        // Add custom embed button
        var embedButton = document.querySelector('.ql-embed');
        embedButton.addEventListener('click', function() {
            document.getElementById('embedPopup').style.display = 'flex';
        });

        // Handle embed button click
        document.getElementById('embedButton').addEventListener('click', function() {
            var embedOption = document.querySelector('input[name="embedOption"]:checked').value;
            var embedInput = document.getElementById('embedInput').value;
            if (embedOption === 'code') {
                quill.clipboard.dangerouslyPasteHTML(embedInput);
            } else if (embedOption === 'link') {
                var embedUrl;
                if (embedInput.includes('scratch.mit.edu/projects/')) {
                    var projectID = embedInput.split('/').pop();
                    embedUrl = `https://turbowarp.org/${projectID}/embed?addons=pause`;
                } else {
                    embedUrl = embedInput; // Assume the input is already an embeddable link
                }
                quill.clipboard.dangerouslyPasteHTML(`<iframe src="${embedUrl}" style="width:100%;height:400px;border:0;"></iframe>`);
            }
            document.getElementById('embedPopup').style.display = 'none';
        });

        // Handle cancel button click
        document.getElementById('cancelButton').addEventListener('click', function() {
            document.getElementById('embedPopup').style.display = 'none';
        });
    </script>
</body>
</html>
